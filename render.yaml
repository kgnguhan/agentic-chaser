# Render Blueprint: Agentic Chaser
# Deploy from GitHub: connect repo and use this Blueprint, or create Web Service + PostgreSQL manually.

databases:
  - name: agentic-chaser-db
    plan: free
    databaseName: agentic_chaser
    user: agentic_chaser

services:
  - type: web
    name: agentic-chaser
    runtime: python
    plan: free

    # Use a venv so the start command sees the same Python and packages (Render run env can differ from build)
    buildCommand: python -m venv venv && venv/bin/pip install --upgrade pip && venv/bin/pip install -r requirements.txt
    # Free tier does not support preDeployCommand; run init-db on start (idempotent)
    startCommand: venv/bin/python main.py init-db && venv/bin/streamlit run dashboard/streamlit_app.py --server.port=$PORT --server.address=0.0.0.0 --server.headless true

    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: agentic-chaser-db
          property: connectionString
      - key: PYTHON_VERSION
        value: "3.11.7"
